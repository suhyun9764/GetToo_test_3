<!DOCTYPE html>
<html lang="en">
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="description" content="">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- The above 4 meta tags *must* come first in the head; any other head content must come *after* these tags -->

    <!-- Title -->
    <title>GET-TOO 회원가입</title>

    <!-- Favicon -->
    <link rel="icon" href="/img/core-img/favicon.ico">

    <!-- Stylesheet -->
    <link rel="stylesheet" href="/style_join.css">
    <script src="/js/jquery/jquery-2.2.4.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js" integrity="sha512-uto9mlQzrs59VwILcLiRYeLKPPbS/bT71da/OEBYEwcdNUk8jYIy+D176RYoop1Da+f9mvkYrmj5MCLZWEtQuA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.css" integrity="sha512-aOG0c6nPNzGk+5zjwyJaoRUgCdOrfSDhmMID2u4+OIslr0GjpLKo7Xm0Ao3xmpM4T8AmIouRkqwj1nrdVsLKEQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />

</head>

<body>
    <!-- Preloader -->
    <div class="preloader d-flex align-items-center justify-content-center">
        <div class="lds-ellipsis">
            <div></div>
            <div></div>
            <div></div>
            <div></div>
        </div>
    </div>
    
    <!-- login area -->
    <section class="join_form">
        <h1> 회원가입 </h1>
        <form action="/client/join" method="POST">
            <div class="int-area">
                <input type="text" name="id" id="id" autocomplete="off" required  maxlength="20">
                <label for="id"> 아이디 </label>
                <button id="idbtn">중복 확인</button>
            </div>

            <div class="int-area">
                <input type="text" name="name" id="name" autocomplete="off" required  maxlength="3">
                <label for="name"> 이름 </label>
            </div>

            <div class="int-area">
                <input type="password" name="password" id="password" autocomplete="off" required minlength="7" maxlength="20">
                <label for="password"> 비밀번호 (7자 이상)</label>
            </div>
                <div class="int-area">
                <input type="password" name="pwCheck" id="pwcheck" autocomplete="off" required  minlength="7" maxlength="20">
                <label for="pwcheck"> 비밀번호 확인 (7자 이상)</label>
            </div>
            <div class="int-area">
                <input type="text" class="datepicker" name="age" readonly="readonly" id="age" autocomplete="off" required style="cursor: pointer;">
                <label for="age"> 생년월일 </label>
            </div>
            <div class="int-area">
                <input type="email" name="email" id="email" autocomplete="off" required>
                <label for="email"> 이메일 </label>
            </div>
    
            <div class="int-area1">
                <input type="classNum" name ="studentNumber" id="studentNumber" maxlength="8" minlength="8" autocomplete="off" required>
                <label for="studentNumber"> 학번 </label>
            </div>
            
            <select name = "department">
                <option value = "">학과</option>
                <option value = "정보보안학과">정보보안학과</option>
                <option value = "단과대">영어영문학과</option>

            </select>
            <div class="int-radio">
                <div class="school"> 재학여부 </div>
                <label for="school1"><input type="radio" name="school" id="school1" value="ing"> 재학생 </label>
                <label for="school2"><input type="radio" name="school" id="school2" value="rest"> 휴학생 </label>
                <label for="school3"><input type="radio" name="school" id="school3" value="end"> 졸업생 </label>
            </div>   mm 
            <div class="btn-area">
                <button id="btn" type="submit"> 회원가입 </button>
            </div>
        </form>
    </section>

    <script>
        $.datepicker.setDefaults({
            dateFormat: 'yy-mm-dd',
            prevText: '이전 달',
            nextText: '다음 달',
            monthNames: ['1월', '2월', '3월', '4월', '5월', '6월', '7월', '8월', '9월', '10월', '11월', '12월'],
            monthNamesShort: ['1월', '2월', '3월', '4월', '5월', '6월', '7월', '8월', '9월', '10월', '11월', '12월'],
            dayNames: ['일', '월', '화', '수', '목', '금', '토'],
            dayNamesShort: ['일', '월', '화', '수', '목', '금', '토'],
            dayNamesMin: ['일', '월', '화', '수', '목', '금', '토'],
            showMonthAfterYear: true,
            yearSuffix: '년'
        });
        $(function(){
            $('.datepicker').datepicker();
        });
        let id = $('#id');
        let pw = $('#pw');
        let pwCheck = $('#pwCheck');
        let birthday = $('#birthday');
        let email = $('#email');
        let cellphoneNo = $('#cellphoneNo');
        let school = $('#school');
        let readcheck = $('#readcheck');
        let btn = $('#btn');

        $(btn).on('click', function() {
            if($(id).val() == "") {
                $(id).next('label').addClass('warning');
                setTimeout(function() {
                    $('label').removeClass('warning');
                },1500);
            }
            else if($(pw).val() == "") {
                $(pw).next('label').addClass('warning');
                setTimeout(function() {
                    $('label').removeClass('warning');
                },1500);
            }
        });
        $(function() {
            $('#idbtn').click(function() {
                var id = $('#id').val();
                $.ajax({
                    url: '/client/check-id',
                    type: 'POST',
                    data: { id: id },
                    success: function(result) {
                        if (result === 'available') {
                            alert('사용가능한 아이디입니다');
                        } else if (result === 'not-available') {
                            alert('이미 사용 중인 아이디입니다.');
                        } else {
                            alert('알 수 없는 오류가 발생했습니다.');
                        }
                    }
                });
            });
        });

        $(function(){
            // 회원 가입 처리
            $('#join-submit').click(function(e){
                e.preventDefault();
                if($("#id").val() ==''){
                    alert('아이디를 입력하세요');
                    $("#id").focus();
                    return false;
                }

                if($("#pw").val() ==''){
                    alert('비밀번호를 입력하세요');
                    $("#pw").focus();
                    return false;
                }

                if($("#pwCheck").val() ==''){
                    alert('비밀번호를 다시 한번 더 입력하세요');
                    $("#pwCheck").focus();
                    return false;
                }

                var email = $('#email').val();
                if(email == ''){
                    alert('이메일을 입력하세요');
                    $("#email").focus();
                    return false;
                } else {
                    var emailRegex = /^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;
                    if (!emailRegex.test(email)) {
                        alert('이메일 주소가 유효하지 않습니다. ex)abc@gmail.com');
                        $("#email").focus();
                        return false;
                    }
                }

                if($("#cellphoneNo").val() ==''){
                    alert('휴대폰 번호를 입력하세요');
                    $("#cellphoneNo").focus();
                    return false;
                }
                if($("#chackup").val() ==''){
                    alert('휴대폰 번호를 입력하세요');
                    $("#cellphoneNo").focus();
                    return false;
                }
                
                
                $.ajax({
                    url: 'register.php',
                    type: 'POST',
                    data: {
                        name:$("#name").val(),
                        userID:$('#id').val(),
                        email:$('#email').val(),
                        password:$('#pw').val(),
                        mobileNO:$("#cellphoneNo").val()
                    },
                    dataType: "json",
                    success: function (response) {
                        if(response.result == 1){
                            alert('가입 완료');
                            location.replace('../index.php'); // 화면 갱신
                        } else if(response.result == 0){
                            alert('이미 가입된 아이디입니다');
                        } else if(response.result == -2){
                            alert('입력된 값이 없습니다');
                        } else {
                            alert('등록중에 에러가 발생했습니다');
                        }
                    },
                    error: function(jqXHR, textStatus, errorThrown){
                        alert("arjax error : " + textStatus + "\n" + errorThrown);
                    }
                });
            });
        });

        
    </script>
</body>
</html>